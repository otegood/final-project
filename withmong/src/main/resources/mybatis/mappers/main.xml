<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.withmong.dao.MainDao">

	<!--인기순으로  내역 가져오기 -->

  	<select id="getAvglikeList" parameterType="Criteria" resultType="Product">
	 	<![CDATA[
	 	 select * from ( select row_number() over (order by avglike desc) as rn , title, price, avglike, no, userid, img, video, contents, qty, regdate, hits, tag, location, categoryno from product_table )  where rn >= #{beginIndex} and rn < #{endIndex}+1 
		]]>
  	</select>

	<!-- 등록순으로 내역 가져오기 -->
  	<select id="getRegList" parameterType="Criteria" resultType="Product">
	 	<![CDATA[
	 	 select * from ( select row_number() over (order by regdate desc) as rn , title, price, avglike, no, userid, img, video, contents, qty, regdate, hits, tag, location, categoryno from product_table )  where rn >= #{beginIndex} and rn < #{endIndex}+1  
		]]>
  	</select>
	

	
	<!-- 조회순으로 내역 가져오기 -->

  	<select id="getHitList" parameterType="Criteria" resultType="Product">
	 	<![CDATA[
	 	 select * from ( select row_number() over (order by hits desc) as rn , title, price, avglike, no, userid, img, video, contents, qty, regdate, hits, tag, location, categoryno from product_table )  where rn >= #{beginIndex} and rn < #{endIndex}+1  
		]]>
  	</select>

	
	
	<!-- 상품 총 개수 구하기? -->
	<select id="getTotalRows" parameterType="Criteria" resultType="int">
		  select count(*) from product_table
	</select>

  	
  	<!-- 카테고리 번호 별로 상품 가지고 오기 -->
  	<select id="getCateproductList" parameterType="int" resultType="Product">
  			select
  				p.no,
				p.title,
				p.userid,
				p.img,
				p.video,
				p.contents,
				p.price,
				p.qty,
				p.regdate,
				p.avglike,
				p.hits,
				p.tag,
				p.categoryno as "category.no",
				p.location as "location.no",
				c.no,
				c.bno,
				c.name
				 
			from 
				product_table p ,
								(select a.name, a.bno, a.no
								from Category_table A , Category_table B
								where a.bno = b.no) c
			where 
				p.categoryno = c.no
				and c.bno = {#value}
  	</select>
</mapper>
